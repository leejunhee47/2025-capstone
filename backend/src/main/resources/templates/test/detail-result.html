<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ìƒì„¸ ê²°ê³¼ API í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 40px; background-color: #f4f6f9; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }

        h1 { border-bottom: 2px solid #eee; padding-bottom: 15px; margin-top: 0; }
        .api-info { background: #e8f0fe; padding: 10px; border-radius: 5px; color: #1967d2; font-family: monospace; margin-bottom: 20px; }

        /* ë¡œë”©/ì—ëŸ¬ ë©”ì‹œì§€ */
        .status-msg { text-align: center; font-size: 1.2em; padding: 30px; font-weight: bold; }
        .loading { color: #f39c12; }
        .error { color: #e74c3c; }

        /* ë°ì´í„° í‘œì‹œ ì˜ì—­ (ì²˜ìŒì—” ìˆ¨ê¹€) */
        #data-container { display: none; }

        /* ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        h2 { margin-top: 40px; font-size: 1.3em; border-left: 5px solid #3498db; padding-left: 10px; color: #2c3e50; }

        .grid-box { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .info-card { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #eee; }
        .label { font-size: 0.8em; color: #7f8c8d; font-weight: bold; display: block; margin-bottom: 5px; text-transform: uppercase; }
        .value { font-size: 1.1em; font-weight: 600; color: #2c3e50; }

        /* íŒì • ìŠ¤íƒ€ì¼ */
        .verdict-FAKE { color: #c0392b; }
        .verdict-REAL { color: #27ae60; }

        /* ìš”ì•½ ë°•ìŠ¤ */
        .summary-box { background-color: #fff8f8; border: 1px solid #f5c6cb; padding: 20px; border-radius: 8px; margin-top: 15px; }
        .phoneme-badge { display: inline-block; background: #ffebee; color: #c62828; padding: 2px 8px; border-radius: 12px; font-size: 0.9em; margin-right: 5px; font-weight: bold; }

        .btn { display: inline-block; padding: 10px 20px; background: #95a5a6; color: white; text-decoration: none; border-radius: 5px; margin-top: 30px; }
        .btn:hover { background: #7f8c8d; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“Š ìƒì„¸ ê²°ê³¼ API ê²€ì¦</h1>

    <div class="api-info">
        Target API: <span id="target-url">Waiting...</span>
    </div>

    <div id="status-display" class="status-msg loading">
        <span th:if="${resultId != null}">ë°ì´í„° ë¡œë”© ì¤‘...</span>
        <span th:unless="${resultId != null}" th:text="${message}">ë¶„ì„ ëŒ€ê¸° ì¤‘...</span>
    </div>

    <div id="data-container">

        <h2>ğŸ¥ ì˜ìƒ ì •ë³´ (Video Info)</h2>
        <div class="grid-box">
            <div class="info-card"><span class="label">ì¬ìƒ ì‹œê°„</span><span class="value" id="durationSec">-</span> sec</div>
            <div class="info-card"><span class="label">í•´ìƒë„</span><span class="value" id="resolution">-</span></div>
            <div class="info-card"><span class="label">FPS</span><span class="value" id="fps">-</span></div>
            <div class="info-card"><span class="label">ì´ í”„ë ˆì„</span><span class="value" id="totalFrames">-</span></div>
        </div>

        <h2>ğŸ” íƒì§€ ì •ë³´ (Detection Info)</h2>
        <div class="grid-box">
            <div class="info-card"><span class="label">íŒì • (Verdict)</span><span class="value" id="verdict">-</span></div>
            <div class="info-card"><span class="label">ì‹ ë¢°ë„</span><span class="value" id="confidence">-</span></div>
            <div class="info-card"><span class="label">ê°€ì§œ í™•ë¥ </span><span class="value" id="probFake" style="color:#e74c3c;">-</span></div>
            <div class="info-card"><span class="label">ì§„ì§œ í™•ë¥ </span><span class="value" id="probReal" style="color:#27ae60;">-</span></div>
        </div>

        <h2>ğŸ“ AI ìš”ì•½ (Summary Info)</h2>
        <div class="summary-box">
            <h3 id="summaryTitle" style="margin-top:0;">-</h3>
            <p><strong>ìœ„í—˜ë„:</strong> <span id="summaryRiskLevel">-</span></p>
            <p><strong>ì£¼ìš” ì›ì¸:</strong> <span id="summaryPrimaryReason">-</span></p>
            <p><strong>ì˜ì‹¬ ìŒì†Œ:</strong> <span id="phonemesArea">-</span></p>
            <hr style="border-top:1px dashed #ccc;">
            <p id="summaryDetailedExplanation" style="white-space: pre-wrap; color:#555;">-</p>
        </div>

        <div style="margin-top: 15px; font-size: 0.8em; color: #aaa;">
            Data fetched at: <span id="fetchedAt">-</span>
        </div>
    </div>

    <a th:href="@{/api/test/detection/result/{id}(id=${requestId})}" class="btn">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
</div>

<script th:if="${resultId != null}">
    const resultId = [[${resultId}]]; // íƒ€ì„ë¦¬í”„ ë³€ìˆ˜ -> JS ë³€ìˆ˜
    const apiUrl = '/api/v1/record/' + resultId;

    document.getElementById('target-url').innerText = "GET " + apiUrl;

    // í˜ì´ì§€ ë¡œë“œ ì‹œ Fetch ì‹¤í–‰
    fetch(apiUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error("API Error: " + response.status);
            }
            return response.json();
        })
        .then(data => {
            console.log("Response Data:", data); // ë””ë²„ê¹…ìš© ë¡œê·¸

            // 1. Video Info ë°”ì¸ë”©
            document.getElementById('durationSec').innerText = data.durationSec;
            document.getElementById('resolution').innerText = data.resolution;
            document.getElementById('fps').innerText = data.fps;
            document.getElementById('totalFrames').innerText = data.totalFrames;

            // 2. Detection Info ë°”ì¸ë”©
            const verdictEl = document.getElementById('verdict');
            verdictEl.innerText = data.verdict;
            verdictEl.className = "value " + (data.verdict === 'FAKE' ? 'verdict-FAKE' : 'verdict-REAL');

            document.getElementById('confidence').innerText = (data.confidence * 100).toFixed(1) + "%";
            document.getElementById('probFake').innerText = data.probabilityFake.toFixed(1) + "%";
            document.getElementById('probReal').innerText = data.probabilityReal.toFixed(1) + "%";

            // 3. Summary Info ë°”ì¸ë”©
            document.getElementById('summaryTitle').innerText = data.summaryTitle;
            document.getElementById('summaryRiskLevel').innerText = data.summaryRiskLevel;
            document.getElementById('summaryPrimaryReason').innerText = data.summaryPrimaryReason;
            document.getElementById('summaryDetailedExplanation').innerText = data.summaryDetailedExplanation;

            // ìŒì†Œ ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬
            const phonemesArea = document.getElementById('phonemesArea');
            if (data.summaryTopSuspiciousPhonemes && data.summaryTopSuspiciousPhonemes.length > 0) {
                phonemesArea.innerHTML = ""; // ì´ˆê¸°í™”
                data.summaryTopSuspiciousPhonemes.forEach(ph => {
                    const span = document.createElement("span");
                    span.className = "phoneme-badge";
                    span.innerText = ph;
                    phonemesArea.appendChild(span);
                });
            } else {
                phonemesArea.innerText = "ì—†ìŒ";
            }

            // 4. UI ì „í™˜
            document.getElementById('status-display').style.display = 'none';
            document.getElementById('data-container').style.display = 'block';
            document.getElementById('fetchedAt').innerText = new Date().toLocaleString();
        })
        .catch(error => {
            console.error(error);
            const statusDiv = document.getElementById('status-display');
            statusDiv.innerText = "âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: " + error.message;
            statusDiv.className = "status-msg error";
        });
</script>

</body>
</html>